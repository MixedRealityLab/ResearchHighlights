var wordCount=1500,year=1;
$(function(){var e=0;$(".collapse").each(function(a){$(this).hasClass("stage-editor")?e++:$(this).delay(400*(a-e)).fadeIn()});ReHi.showAlert("Welcome!","Please enter your credentials to continue.","info");ReHi.regSubForm($("form.stage-login"),ReHi.urlPrefix+"do/login",function(a,b,c){"-3"==a?ReHi.showError("Humph!",'Your account has been disabled. \x3ca href\x3d"mailto:cdt-rh@porcheron.uk" class\x3d"alert-link"\x3eEmail support\x3c/a\x3e for help.'):"-1"==a?ReHi.showError("Oh, snap!",'Looks like you\'ve entered an invalid username/password combination. \x3ca href\x3d"mailto:cdt-rh@porcheron.uk" class\x3d"alert-link"\x3eEmail support\x3c/a\x3e for help.'):
"1"==a.success&&(ReHi.showSuccess("Welcome!","Your login was successful. You can log back in any time to modify your submission before the deadline."),$(".wordlimit").text(a.wordCount),$(".name").text(a.name),$("#submit-user").attr("value",$("#username").val()),$("#submit-pass").attr("value",$("#password").val()),$("#cohort").attr("value",a.cohort),$("#name").attr("value",a.name),$("#email").attr("value",a.email),$("#tweet").val(a.tweet),$("#tweet").triggerHandler("keyup"),$("#twitter").val(a.twitter),
$("#title").val(a.title),$("#website").attr("value",a.website),$.each(a.keywords.split(","),function(a,b){$("#keywords").tagsinput("add",b)}),$("#industryName").attr("value",a.industryName),$("#industryUrl").attr("value",a.industryUrl),$("#text").val(a.text),$("#references").val(a.references),$(".preview-supported").data("fundingStatement",a.fundingStatement),$("#text").triggerHandler("keyup"),$("#references").triggerHandler("keyup"),$(".stage-login").fadeOut({complete:function(){$(".stage-editor").fadeIn();
$(".stage-editor input").triggerHandler("change");$(".stage-editor textarea").each(function(){$(this).trigger("autosize.resize")})}}))},"json");ReHi.regAutoForm($("form.stage-editor"),ReHi.urlPrefix+"do/preview",function(a,b,c){b=$("#title").val();$(".preview-title").html(0==b.length?"Preview":b);b=$("#industryName").val();c=$("#industryUrl").val();var d="\x3csmall\x3e"+$(".preview-supported").data("fundingStatement");""==b?$(".preview-supported").html($(d+".\x3c/small\x3e")):""==c||"http://"==c?
$(".preview-supported").html($(d+" and by \x3cspan\x3e"+b+"\x3c/span\x3e.\x3c/small\x3e")):$(".preview-supported").html($(d+' and by \x3ca href\x3d"'+c+'" target\x3d"_blank"\x3e'+b+"\x3c/a\x3e.\x3c/small\x3e"));$(".preview-input").html(a)});ReHi.regSubForm($("form.stage-editor"),ReHi.urlPrefix+"do/submit",function(a,b,c){"1"!=a?ReHi.showError("Goshdarnit!",'Something has gone wrong! \x3ca href\x3d"mailto:cdt-rh@porcheron.uk" class\x3d"alert-link"\x3eI need help!\x3c/a\x3e (error: '+a+")"):ReHi.showSuccess("Whoop! Whoop!",
'Your submission was saved! For reference, you can see the latest version of \x3ca href\x3d"'+ReHi.urlPrefix+"read#"+$("#submit-user").attr("value")+'" target\x3d"_blank"\x3eyour submission\x3c/a\x3e online (although it may not look like this in the final website).')});$('a[href\x3d"#content"]').on("shown.bs.tab",function(a){$("#text").show().trigger("autosize.resize")});$("textarea").autosize();$("#keywords").on("beforeItemAdd",function(a){var b=!1;$.each($("#keywords").tagsinput("items"),function(c,
d){b||d.toLowerCase()!=a.item.toLowerCase()||(b=!0)});a.cancel=b});$("#tweet").keyup(function(a){ReHi.charCount($(this),$(".tweet-rem"),140)});$("#text").keyup(function(a){ReHi.wordCount($(this),$(".text-rem"),wordCount)});$("a").click(function(a){if("#"!=$(this).attr("href").substring(0,1)&&$(".stage-editor").is(":visible")&&!confirm("If you continue, any unsubmitted changes may be lost"))return a.preventDefault(),!1});$("#logout").click(function(a){confirm("If you logout, any unsubmitted changes will be lost!")&&
window.location.reload()});$("#submit").click(function(a){a.preventDefault();0==$("#title").val().length?ReHi.showError("Whoopsie!","You need to give your submission a title!"):0==$("#keywords").tagsinput("items").length?ReHi.showError("Oh dear!","You need to enter at least \x3cstrong\x3efive\x3c/strong\x3e keywords!"):5>$("#keywords").tagsinput("items").length?ReHi.showError("Oh dear!","You need to enter \x3cstrong\x3e"+(5-$("#keywords").tagsinput("items").length)+"\x3c/strong\x3e more keywords"):
25>$("#tweet").val().length?ReHi.showError("Oh dear!","You should enter a better 140-character summary of your PhD"):(ReHi.showAlert("Just a moment!","Saving your submission. Please don't leave or refresh this page until a success message appears (resubmit if need be).","info"),setTimeout(function(){$("form.stage-editor").triggerHandler("submit")},500))})});