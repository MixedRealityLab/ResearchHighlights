(function(d){function m(a,b){this.itemsArray=[];this.$element=d(a);this.$element.hide();this.multiple=(this.isSelect="SELECT"===a.tagName)&&a.hasAttribute("multiple");this.objectItems=b&&b.itemValue;this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=d('\x3cdiv class\x3d"bootstrap-tagsinput"\x3e\x3c/div\x3e');this.$input=d('\x3cinput type\x3d"text" placeholder\x3d"'+this.placeholderText+'"/\x3e').appendTo(this.$container);
this.$element.after(this.$container);var c=(3>this.inputSize?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+c+" !important;";this.build(b)}function n(a,b){if("function"!==typeof a[b]){var c=a[b];a[b]=function(b){return b[c]}}}function p(a,b){if("function"!==typeof a[b]){var c=a[b];a[b]=function(){return c}}}function f(a){return a?s.text(a).html():""}function q(a){var b=0;if(document.selection)a.focus(),b=document.selection.createRange(),b.moveStart("character",-a.value.length),
b=b.text.length;else if(a.selectionStart||"0"==a.selectionStart)b=a.selectionStart;return b}function t(a,b){var c=!1;d.each(b,function(b,d){if("number"===typeof d&&a.which===d)return c=!0,!1;if(a.which===d.which){var k=!d.hasOwnProperty("altKey")||a.altKey===d.altKey,h=!d.hasOwnProperty("shiftKey")||a.shiftKey===d.shiftKey,l=!d.hasOwnProperty("ctrlKey")||a.ctrlKey===d.ctrlKey;if(k&&h&&l)return c=!0,!1}});return c}var r={tagClass:function(a){return"label label-info"},itemValue:function(a){return a?
a.toString():a},itemText:function(a){return this.itemValue(a)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(a,b){b.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};m.prototype={constructor:m,add:function(a,b){var c=this;if(!(c.options.maxTags&&c.itemsArray.length>=c.options.maxTags||!1!==a&&!a)){"string"===typeof a&&c.options.trimValue&&(a=d.trim(a));if("object"===typeof a&&!c.objectItems)throw"Can't add objects when itemValue option is not set";
if(!a.toString().match(/^\s*$/)){c.isSelect&&!c.multiple&&0<c.itemsArray.length&&c.remove(c.itemsArray[0]);if("string"===typeof a&&"INPUT"===this.$element[0].tagName){var e=a.split(",");if(1<e.length){for(var g=0;g<e.length;g++)this.add(e[g],!0);b||c.pushVal();return}}var k=c.options.itemValue(a),e=c.options.itemText(a),g=c.options.tagClass(a),h=d.grep(c.itemsArray,function(b){return c.options.itemValue(b)===k})[0];if(h&&!c.options.allowDuplicates)c.options.onTagExists&&(e=d(".tag",c.$container).filter(function(){return d(this).data("item")===
h}),c.options.onTagExists(a,e));else if(!(c.items().toString().length+a.length+1>c.options.maxInputLength)){var l=d.Event("beforeItemAdd",{item:a,cancel:!1});c.$element.trigger(l);l.cancel||(c.itemsArray.push(a),g=d('\x3cspan class\x3d"tag '+f(g)+'"\x3e'+f(e)+'\x3cspan data-role\x3d"remove"\x3e\x3c/span\x3e\x3c/span\x3e'),g.data("item",a),c.findInputWrapper().before(g),g.after(" "),c.isSelect&&!d('option[value\x3d"'+encodeURIComponent(k)+'"]',c.$element)[0]&&(e=d("\x3coption selected\x3e"+f(e)+"\x3c/option\x3e"),
e.data("item",a),e.attr("value",k),c.$element.append(e)),b||c.pushVal(),c.options.maxTags!==c.itemsArray.length&&c.items().toString().length!==c.options.maxInputLength||c.$container.addClass("bootstrap-tagsinput-max"),c.$element.trigger(d.Event("itemAdded",{item:a})))}}}},remove:function(a,b){var c=this;c.objectItems&&(a="object"===typeof a?d.grep(c.itemsArray,function(b){return c.options.itemValue(b)==c.options.itemValue(a)}):d.grep(c.itemsArray,function(b){return c.options.itemValue(b)==a}),a=a[a.length-
1]);if(a){var e=d.Event("beforeItemRemove",{item:a,cancel:!1});c.$element.trigger(e);if(e.cancel)return;d(".tag",c.$container).filter(function(){return d(this).data("item")===a}).remove();d("option",c.$element).filter(function(){return d(this).data("item")===a}).remove();-1!==d.inArray(a,c.itemsArray)&&c.itemsArray.splice(d.inArray(a,c.itemsArray),1)}b||c.pushVal();c.options.maxTags>c.itemsArray.length&&c.$container.removeClass("bootstrap-tagsinput-max");c.$element.trigger(d.Event("itemRemoved",{item:a}))},
removeAll:function(){d(".tag",this.$container).remove();for(d("option",this.$element).remove();0<this.itemsArray.length;)this.itemsArray.pop();this.pushVal()},refresh:function(){var a=this;d(".tag",a.$container).each(function(){var b=d(this),c=b.data("item"),e=a.options.itemValue(c),g=a.options.itemText(c),k=a.options.tagClass(c);b.attr("class",null);b.addClass("tag "+f(k));b.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=f(g);a.isSelect&&d("option",a.$element).filter(function(){return d(this).data("item")===
c}).attr("value",e)})},items:function(){return this.itemsArray},pushVal:function(){var a=this,b=d.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(b,!0).trigger("change")},build:function(a){var b=this;b.options=d.extend({},r,a);b.objectItems&&(b.options.freeInput=!1);n(b.options,"itemValue");n(b.options,"itemText");p(b.options,"tagClass");if(b.options.typeahead){var c=b.options.typeahead||{};p(c,"source");b.$input.typeahead(d.extend({},c,{source:function(a,e){function h(a){for(var c=
[],d=0;d<a.length;d++){var g=b.options.itemText(a[d]);l[g]=a[d];c.push(g)}e(c)}var l=this.map={},f=c.source(a);d.isFunction(f.success)?f.success(h):d.isFunction(f.then)?f.then(h):d.when(f).then(h)},updater:function(a){b.add(this.map[a])},matcher:function(b){return-1!==b.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(b){return b.sort()},highlighter:function(b){return b.replace(RegExp("("+this.query+")","gi"),"\x3cstrong\x3e$1\x3c/strong\x3e")}}))}if(b.options.typeaheadjs){var e=
b.options.typeaheadjs||{};b.$input.typeahead(null,e).on("typeahead:selected",d.proxy(function(a,c){e.valueKey?b.add(c[e.valueKey]):b.add(c);b.$input.typeahead("val","")},b))}b.$container.on("click",d.proxy(function(a){b.$element.attr("disabled")||b.$input.removeAttr("disabled");b.$input.focus()},b));if(b.options.addOnBlur&&b.options.freeInput)b.$input.on("focusout",d.proxy(function(a){0===d(".typeahead, .twitter-typeahead",b.$container).length&&(b.add(b.$input.val()),b.$input.val(""))},b));b.$container.on("keydown",
"input",d.proxy(function(a){var c=d(a.target),e=b.findInputWrapper();if(b.$element.attr("disabled"))b.$input.attr("disabled","disabled");else{switch(a.which){case 8:0===q(c[0])&&(e=e.prev())&&b.remove(e.data("item"));break;case 46:0===q(c[0])&&(e=e.next())&&b.remove(e.data("item"));break;case 37:a=e.prev();0===c.val().length&&a[0]&&(a.before(e),c.focus());break;case 39:a=e.next(),0===c.val().length&&a[0]&&(a.after(e),c.focus())}e=c.val().length;Math.ceil(e/5);c.attr("size",Math.max(this.inputSize,
c.val().length))}},b));b.$container.on("keypress","input",d.proxy(function(a){var c=d(a.target);if(b.$element.attr("disabled"))b.$input.attr("disabled","disabled");else{var e=c.val(),f=b.options.maxChars&&e.length>=b.options.maxChars;b.options.freeInput&&(t(a,b.options.confirmKeys)||f)&&(b.add(f?e.substr(0,b.options.maxChars):e),c.val(""),a.preventDefault());a=c.val().length;Math.ceil(a/5);c.attr("size",Math.max(this.inputSize,c.val().length))}},b));b.$container.on("click","[data-role\x3dremove]",
d.proxy(function(a){b.$element.attr("disabled")||b.remove(d(a.target).closest(".tag").data("item"))},b));b.options.itemValue===r.itemValue&&("INPUT"===b.$element[0].tagName?b.add(b.$element.val()):d("option",b.$element).each(function(){b.add(d(this).attr("value"),!0)}))},destroy:function(){this.$container.off("keypress","input");this.$container.off("click","[role\x3dremove]");this.$container.remove();this.$element.removeData("tagsinput");this.$element.show()},focus:function(){this.$input.focus()},
input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],b=this.$container[0];a&&a.parentNode!==b;)a=a.parentNode;return d(a)}};d.fn.tagsinput=function(a,b){var c=[];this.each(function(){var e=d(this).data("tagsinput");e?a||b?void 0!==e[a]&&(e=e[a](b),void 0!==e&&c.push(e)):c.push(e):(e=new m(this,a),d(this).data("tagsinput",e),c.push(e),"SELECT"===this.tagName&&d("option",d(this)).attr("selected","selected"),d(this).val(d(this).val()))});return"string"==typeof a?
1<c.length?c:c[0]:c};d.fn.tagsinput.Constructor=m;var s=d("\x3cdiv /\x3e");d(function(){d("input[data-role\x3dtagsinput], select[multiple][data-role\x3dtagsinput]").tagsinput()})})(window.jQuery);